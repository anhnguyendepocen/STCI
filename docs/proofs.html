<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A Proofs | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="A Proofs | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Proofs | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="The SKY Community">


<meta name="date" content="2019-09-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="Bounds.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\DeclareMathOperator{\diag}{diag}
$$


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a><ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a><ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a><ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a><ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a><ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a><ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a><ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshev’s inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a><ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a><ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Randomization After Self-Selection</a><ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Randomization After Eligibility</a><ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a><ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-of-the-local-average-treatment-effect"><i class="fa fa-check"></i><b>3.4.1</b> Identification of the Local Average Treatment Effect</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.2</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="RCT.html"><a href="RCT.html#sec:threats"><i class="fa fa-check"></i><b>3.5</b> Threats to the validity of RCTs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a></li>
<li class="chapter" data-level="5" data-path="sec-OM.html"><a href="sec-OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="6" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>6</b> Power Analysis</a></li>
<li class="chapter" data-level="7" data-path="Placebo.html"><a href="Placebo.html"><i class="fa fa-check"></i><b>7</b> Placebo Tests</a></li>
<li class="chapter" data-level="8" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>8</b> Clustering</a></li>
<li class="chapter" data-level="9" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>9</b> LaLonde Tests</a></li>
<li class="chapter" data-level="10" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>10</b> Diffusion effects</a></li>
<li class="chapter" data-level="11" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>11</b> Distributional effects</a></li>
<li class="chapter" data-level="12" data-path="sec-meta.html"><a href="sec-meta.html"><i class="fa fa-check"></i><b>12</b> Meta-analysis and Publication Bias</a><ul>
<li class="chapter" data-level="12.1" data-path="sec-meta.html"><a href="sec-meta.html#meta-analysis"><i class="fa fa-check"></i><b>12.1</b> Meta-analysis</a><ul>
<li class="chapter" data-level="12.1.1" data-path="sec-meta.html"><a href="sec-meta.html#basic-setting"><i class="fa fa-check"></i><b>12.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="12.1.2" data-path="sec-meta.html"><a href="sec-meta.html#meta-analysis-as-a-weighted-average"><i class="fa fa-check"></i><b>12.1.2</b> Meta-analysis as a weighted average</a></li>
<li class="chapter" data-level="12.1.3" data-path="sec-meta.html"><a href="sec-meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>12.1.3</b> Constantly updated meta-analysis</a></li>
<li class="chapter" data-level="12.1.4" data-path="sec-meta.html"><a href="sec-meta.html#testing-for-the-homogeneity-of-treatment-effects"><i class="fa fa-check"></i><b>12.1.4</b> Testing for the homogeneity of treatment effects</a></li>
<li class="chapter" data-level="12.1.5" data-path="sec-meta.html"><a href="sec-meta.html#meta-analysis-when-treatment-effects-are-heterogeneous"><i class="fa fa-check"></i><b>12.1.5</b> Meta-analysis when treatment effects are heterogeneous</a></li>
<li class="chapter" data-level="12.1.6" data-path="sec-meta.html"><a href="sec-meta.html#meta-regression"><i class="fa fa-check"></i><b>12.1.6</b> Meta-regression</a></li>
<li class="chapter" data-level="12.1.7" data-path="sec-meta.html"><a href="sec-meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>12.1.7</b> Why vote-counting does not work</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="sec-meta.html"><a href="sec-meta.html#publication-bias"><i class="fa fa-check"></i><b>12.2</b> Publication bias</a><ul>
<li class="chapter" data-level="12.2.1" data-path="sec-meta.html"><a href="sec-meta.html#sources-of-publication-bias"><i class="fa fa-check"></i><b>12.2.1</b> Sources of publication bias</a></li>
<li class="chapter" data-level="12.2.2" data-path="sec-meta.html"><a href="sec-meta.html#detecting-and-correcting-for-publication-bias"><i class="fa fa-check"></i><b>12.2.2</b> Detecting and correcting for publication bias</a></li>
<li class="chapter" data-level="12.2.3" data-path="sec-meta.html"><a href="sec-meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>12.2.3</b> Vote counting and publication bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>13</b> Bounds</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a><ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a><ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a><ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Lemma @ref(lem:WaldIV)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="proofs" class="section level1">
<h1><span class="header-section-number">A</span> Proofs</h1>
<div id="proofs-of-results-in-chapter-reffpsi" class="section level2">
<h2><span class="header-section-number">A.1</span> Proofs of results in Chapter <a href="FPSI.html#FPSI">2</a></h2>
<div id="proofcheb" class="section level3">
<h3><span class="header-section-number">A.1.1</span> Proof of Theorem <a href="FPSI.html#thm:uppsampnoise">2.3</a></h3>
<p>In order to use Theorem <a href="FPSI.html#thm:cheb">2.2</a> for studying the behavior of <span class="math inline">\(\hat{\Delta^Y_{WW}}\)</span>, we have to prove that it is unbiased and we have to compute <span class="math inline">\(\var{\hat{\Delta^Y_{WW}}}\)</span>. Let’s first prove that the <span class="math inline">\(WW\)</span> estimator is an unbiased estimator of <span class="math inline">\(TT\)</span>:</p>

<div class="lemma">
<p><span id="lem:unbiasww" class="lemma"><strong>Lemma A.1  (Unbiasedness of <span class="math inline">\(\hat{\Delta^Y_{WW}}\)</span>)  </strong></span>Under Assumptions <a href="FPCI.html#def:noselb">1.7</a>, <a href="FPSI.html#def:fullrank">2.3</a> and <a href="FPSI.html#def:iid">2.4</a>,</p>
<span class="math display">\[\begin{align*}
\esp{\hat{\Delta^Y_{WW}}}&amp; = \Delta^Y_{TT}.
\end{align*}\]</span>
</div>


<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> In order to prove Lemma <a href="proofs.html#lem:unbiasww">A.1</a>, we are going to use a trick. We are going to compute the expectation of the <span class="math inline">\(WW\)</span> estimator conditional on a given treatment allocation. Because the resulting estimate is independent of treatment allocation, we will have our proof. This trick simplifies derivations a lot and is really natural: think first of all the samples with the same treatment allocation, then average your results over all possible treatment allocations.</p>
<span class="math display">\[\begin{align*}
\esp{\hat{\Delta^Y_{WW}}} &amp; = \esp{\esp{\hat{\Delta^Y_{WW}}|\mathbf{D}}}\\
                          &amp; = \esp{\esp{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N Y_iD_i-\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}}\\
                          &amp; = \esp{\esp{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N Y_iD_i|\mathbf{D}}-\esp{\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}}\\
                          &amp; = \esp{\frac{1}{\sum_{i=1}^N D_i}\esp{\sum_{i=1}^N Y_iD_i|\mathbf{D}}-\frac{1}{\sum_{i=1}^N (1-D_i)}\esp{\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}}\\
                          &amp; = \esp{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N \esp{Y_iD_i|\mathbf{D}}-\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N \esp{Y_i(1-D_i)|\mathbf{D}}}\\
                          &amp; = \esp{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N \esp{Y_iD_i|D_i}-\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N \esp{Y_i(1-D_i)|D_i}}\\
                          &amp; = \esp{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N D_i\esp{Y_i|D_i=1}-\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N(1-D_i)\esp{Y_i|D_i=0}}\\
                          &amp; = \esp{\frac{\sum_{i=1}^N D_i}{\sum_{i=1}^N D_i}\esp{Y_i|D_i=1}-\frac{\sum_{i=1}^N(1-D_i)}{\sum_{i=1}^N (1-D_i)}\esp{Y_i|D_i=0}}\\
                          &amp; = \esp{\esp{Y_i|D_i=1}-\esp{Y_i|D_i=0}}\\
                          &amp; = \esp{Y_i|D_i=1}-\esp{Y_i|D_i=0} \\
                          &amp; = \Delta^Y_{TT}.
\end{align*}\]</span>
The first equality uses the Law of Iterated Expectations (LIE). The second and fourth equalities use the linearity of conditional expectations. The third equality uses the fact that, conditional on <span class="math inline">\(\mathbf{D}\)</span>, the number of treated and untreated is a constant. The fifth equality uses Assumption <a href="FPSI.html#def:iid">2.4</a>. The sixth equality uses the fact that <span class="math inline">\(\esp{Y_iD_i|D_i}=D_i\esp{Y_i*1|D_i=1}+(1-D_i)\esp{Y_i*0|D_i=0}\)</span>. The seventh and ninth equalities use the fact that <span class="math inline">\(\esp{Y_i|D_i=1}\)</span> is a constant. The last equality uses Assumption <a href="FPCI.html#def:noselb">1.7</a>.
</div>

<p>Let’s now compute the variance of the <span class="math inline">\(WW\)</span> estimator:</p>

<div class="lemma">
<p><span id="lem:varww" class="lemma"><strong>Lemma A.2  (Variance of <span class="math inline">\(\hat{\Delta^Y_{WW}}\)</span>)  </strong></span>Under Assumptions <a href="FPCI.html#def:noselb">1.7</a>, <a href="FPSI.html#def:fullrank">2.3</a> and <a href="FPSI.html#def:iid">2.4</a>,</p>
<span class="math display">\[\begin{align*}
\var{{\hat{\Delta^Y_{WW}}}} &amp; = \frac{1-(1-\Pr(D_i=1))^N}{N\Pr(D_i=1)}\var{Y_i^1|D_i=1}+\frac{1-\Pr(D_i=1)^N}{N(1-\Pr(D_i=1))}\var{Y_i^0|D_i=0}.
\end{align*}\]</span>
</div>


<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> Same trick as before, but now using the Law of Total Variance (LTV):</p>
<span class="math display">\[\begin{align*}
\var{{\hat{\Delta^Y_{WW}}}} &amp; = \esp{\var{\hat{\Delta^Y_{WW}}|\mathbf{D}}}+\var{\esp{\hat{\Delta^Y_{WW}}|\mathbf{D}}}\\
                            &amp; = \esp{\var{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N Y_iD_i-\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}} \\
                            &amp; = \esp{\var{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N Y_iD_i|\mathbf{D}}}+\esp{\var{\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}}\\
                            &amp; \phantom{=}+\esp{\cov{\frac{1}{\sum_{i=1}^N D_i}\sum_{i=1}^N Y_iD_i,\frac{1}{\sum_{i=1}^N (1-D_i)}\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}} \\
                            &amp; = \esp{\frac{1}{(\sum_{i=1}^N D_i)^2}\var{\sum_{i=1}^N Y_iD_i|\mathbf{D}}}+\esp{\frac{1}{(\sum_{i=1}^N (1-D_i))^2}\var{\sum_{i=1}^N Y_i(1-D_i)|\mathbf{D}}} \\
                            &amp; = \esp{\frac{1}{(\sum_{i=1}^N D_i)^2}\var{\sum_{i=1}^N Y_iD_i|D_i}}+\esp{\frac{1}{(\sum_{i=1}^N (1-D_i))^2}\var{\sum_{i=1}^N Y_i(1-D_i)|D_i}} \\
                            &amp; = \esp{\frac{1}{(\sum_{i=1}^N D_i)^2}\sum_{i=1}^ND_i\var{Y_i|D_i=1}}+\esp{\frac{1}{(\sum_{i=1}^N (1-D_i))^2}\sum_{i=1}^N(1-D_i)\var{Y_i|D_i=0}} \\
                            &amp; = \var{Y_i|D_i=1}\esp{\frac{1}{\sum_{i=1}^N D_i}}+\var{Y_i|D_i=0}\esp{\frac{1}{\sum_{i=1}^N (1-D_i)}} \\
                            &amp; = \frac{1-(1-\Pr(D_i=1))^N}{N\Pr(D_i=1)}\var{Y_i^1|D_i=1}+\frac{1-\Pr(D_i=1)^N}{N(1-\Pr(D_i=1))}\var{Y_i^0|D_i=0}.
\end{align*}\]</span>
The first equality stems from the LTV. The second and third equalities stems from the definition of the <span class="math inline">\(WW\)</span> estimator and of the variance of a sum of random variables. The fourth equality stems from Assumption <a href="FPSI.html#def:iid">2.4</a>, which means that the covariance across observations is zero, and from the formula for a variance of a random variable multiplied by a constant. The fifth and sixth equalities stems from Assumption <a href="FPSI.html#def:iid">2.4</a> and from <span class="math inline">\(\var{Y_iD_i|D_i}=D_i\var{Y_i*1|D_i=1}+(1-D_i)\var{Y_i*0|D_i=0}\)</span>. The seventh equality stems from <span class="math inline">\(\var{Y_i|D_i=1}\)</span> and <span class="math inline">\(\var{Y_i|D_i=0}\)</span> being constant. The last equality stems from the formula for the expectation of the inverse of a sum of Bernoulli random variables with at least one of them taking value one which is the case under Assumption <a href="FPSI.html#def:fullrank">2.3</a>.
</div>

<p>Using Theorem <a href="FPSI.html#thm:cheb">2.2</a>, we have:</p>
<span class="math display">\[\begin{align*}
2\epsilon &amp; \leq 2\sqrt{\frac{1}{N(1-\delta)}\left(\frac{1-(1-\Pr(D_i=1))^N}{\Pr(D_i=1)}\var{Y_i^1|D_i=1}+\frac{1-\Pr(D_i=1)^N}{(1-\Pr(D_i=1))}\var{Y_i^0|D_i=0}\right)}\\
          &amp; \leq 2\sqrt{\frac{1}{N(1-\delta)}\left(\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{(1-\Pr(D_i=1))}\right)},
\end{align*}\]</span>
<p>where the second equality stems from the fact that <span class="math inline">\(\frac{(1-\Pr(D_i=1))^N}{\Pr(D_i=1)}\var{Y_i^1|D_i=1}+\frac{\Pr(D_i=1)^N}{(1-\Pr(D_i=1))}\var{Y_i^0|D_i=0}\geq0\)</span>. This proves the result.</p>
</div>
<div id="proofCLT" class="section level3">
<h3><span class="header-section-number">A.1.2</span> Proof of Theorem <a href="FPSI.html#thm:asympnoiseWW">2.5</a></h3>
<p>Before proving Theorem <a href="FPSI.html#thm:asympnoiseWW">2.5</a>, let me state a very useful result: <span class="math inline">\(\hat{WW}\)</span> can be computed using OLS:</p>

<div class="lemma">
<p><span id="lem:WWOLS" class="lemma"><strong>Lemma A.3  (WW is OLS)  </strong></span>Under Assumption <a href="FPSI.html#def:fullrank">2.3</a>, the OLS coefficient <span class="math inline">\(\beta\)</span> in the following regression:</p>
<span class="math display">\[\begin{align*}
        Y_i &amp;  = \alpha +  \beta D_i + U_i
    \end{align*}\]</span>
<p>is the WW estimator:</p>
<span class="math display">\[\begin{align*}
\hat{\beta}_{OLS} &amp; = \frac{\frac{1}{N}\sum_{i=1}^N\left(Y_i-\frac{1}{N}\sum_{i=1}^NY_i\right)\left(D_i-\frac{1}{N}\sum_{i=1}^ND_i\right)}{\frac{1}{N}\sum_{i=1}^N\left(D_i-\frac{1}{N}\sum_{i=1}^ND_i\right)^2} \\
                                &amp; = \hat{\Delta^Y_{WW}}.
\end{align*}\]</span>
</div>


<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> In matrix notation, we have:</p>
<span class="math display">\[\begin{align*}
  \underbrace{\left(\begin{array}{c}  Y_1 \\    \vdots \\   Y_N \end{array}\right)}_{Y} &amp; = 
  \underbrace{\left(\begin{array}{cc}   1 &amp; D_1\\   \vdots &amp; \vdots\\   1 &amp; D_N\end{array}\right)}_{X}
  \underbrace{\left(\begin{array}{c}    \alpha \\   \beta \end{array}\right)}_{\Theta}+
  \underbrace{\left(\begin{array}{c}    U_1 \\  \vdots \\   U_N \end{array}\right)}_{U}
\end{align*}\]</span>
<p>The OLS estimator is:</p>
<span class="math display">\[\begin{align*}
    \hat{\Theta}_{OLS} &amp;  = (X&#39;X)^{-1}X&#39;Y
\end{align*}\]</span>
<p>Under the Full Rank Assumption, <span class="math inline">\(X&#39;X\)</span> is invertible and we have:</p>
<span class="math display">\[\begin{align*}
(X&#39;X)^{-1} &amp;  = \left(\begin{array}{cc} N &amp; \sum_{i=1}^ND_i \\ \sum_{i=1}^ND_i &amp; \sum_{i=1}^ND_i^2 \end{array}\right)^{-1} \\
                &amp; = \frac{1}{N\sum_{i=1}^ND_i^2-\left(\sum_{i=1}^ND_i\right)^2}\left(\begin{array}{cc} \sum_{i=1}^ND_i^2 &amp; -\sum_{i=1}^ND_i \\ -\sum_{i=1}^ND_i &amp; N \end{array}\right)
\end{align*}\]</span>
<p>For simplicity, I omit the summation index:</p>
<span class="math display">\[\begin{align*}
  \hat{\Theta}_{OLS} &amp;  = \frac{1}{N\sum D_i^2-\left(\sum D_i\right)^2}
                          \left(\begin{array}{cc} \sum D_i^2 &amp; -\sum D_i \\ -\sum D_i &amp; N \end{array}\right)
                          \left(\begin{array}{c} \sum Y_i \\  \sum Y_iD_i \end{array}\right) \\
                    &amp; = \frac{1}{N\sum D_i^2-\left(\sum D_i\right)^2}
                        \left(\begin{array}{c} \sum D_i^2\sum Y_i-\sum D_i\sum_{i=1}^NY_iD_i \\
                                              -\sum D_i\sum Y_i+ N\sum Y_iD_i \end{array}\right) \\
\end{align*}\]</span>
<p>Using <span class="math inline">\(D_i^2=D_i\)</span>, we have:</p>
<span class="math display">\[\begin{align*}
  \hat{\Theta}_{OLS} &amp;  =  \left(\begin{array}{c} 
          \frac{\left(\sum D_i\right)\left(\sum Y_i-\sum Y_iD_i\right)}{\left(\sum D_i\right)\left(N-\sum D_i\right)} \\
          \frac{N\sum Y_iD_i-\sum D_i\sum Y_i}{N\sum D_i-\left(\sum D_i\right)^2} 
                            \end{array}\right) 
                        =     \left(\begin{array}{c} 
          \frac{\sum (Y_iD_i+Y_i(1-D_i))-\sum Y_iD_i}{\sum(1-D_i)} \\
          \frac{N^2}{N^2}\frac{\frac{1}{N}\sum Y_iD_i-\frac{1}{N}\sum D_i\frac{1}{N}\sum Y_i+\frac{1}{N}\sum D_i\frac{1}{N}\sum Y_i-\frac{1}{N}\sum D_i\frac{1}{N}\sum Y_i}{\frac{1}{N}\sum D_i-2\left(\frac{1}{N}\sum D_i\right)^2+\left(\frac{1}{N}\sum D_i\right)^2} 
                            \end{array}\right) \\
                      &amp;  =     \left(\begin{array}{c} 
          \frac{\sum Y_i(1-D_i)}{\sum(1-D_i)} \\
          \frac{\frac{1}{N}\sum \left(Y_iD_i-D_i\frac{1}{N}\sum Y_i-Y_i\frac{1}{N}\sum D_i+\frac{1}{N}\sum D_i\frac{1}{N}\sum Y_i\right)}{\frac{1}{N}\sum\left(D_i-2D_i\frac{1}{N}\sum D_i+\left(\frac{1}{N}\sum D_i\right)^2\right)} 
                            \end{array}\right) 
                      =     \left(\begin{array}{c} 
          \frac{\sum Y_i(1-D_i)}{\sum(1-D_i)} \\
    \frac{\frac{1}{N}\sum\left(Y_i-\frac{1}{N}\sum Y_i\right)\left(D_i-\frac{1}{N}\sum D_i\right)}{\frac{1}{N}\sum \left(D_i-\frac{1}{N}\sum D_i\right)^2} 
                            \end{array}\right), 
\end{align*}\]</span>
<p>which proves the first part of the lemma. Now for the second part of the lemma:</p>
<span class="math display">\[\begin{align*}
  \hat{\beta}_{OLS} &amp;  = \frac{\sum Y_iD_i-\frac{1}{N}\sum D_i\sum Y_i}{\sum D_i\left(1-\frac{1}{N}\sum D_i\right)}
                       = \frac{\sum Y_iD_i-\frac{1}{N}\sum D_i\sum\left(Y_iD_i+(1-D_i)Y_i\right)}{\sum D_i\left(1-\frac{1}{N}\sum D_i\right)}\\
                    &amp;  = \frac{\sum Y_iD_i\left(1-\frac{1}{N}\sum D_i\right)-\frac{1}{N}\sum D_i\sum(1-D_i)Y_i}{\sum D_i\left(1-\frac{1}{N}\sum D_i\right)}\\
                    &amp;  = \frac{\sum Y_iD_i}{\sum D_i}-\frac{\frac{1}{N}\sum(1-D_i)Y_i}{\left(1-\frac{1}{N}\sum D_i\right)}\\
                    &amp;  = \frac{\sum Y_iD_i}{\sum D_i}-\frac{\frac{1}{N}\sum(1-D_i)Y_i}{\frac{1}{N}\sum\left(1-D_i\right)}\\
                     &amp;  = \frac{\sum Y_iD_i}{\sum D_i}-\frac{\sum(1-D_i)Y_i}{\sum\left(1-D_i\right)}\\
                     &amp; = \hat{\Delta^Y_{WW}},
\end{align*}\]</span>
which proves the result.
</div>

<p>Now, let me state the most important lemma behind the result in Theorem <a href="FPSI.html#thm:asympnoiseWW">2.5</a>:</p>

<div class="lemma">
<p><span id="lem:asympOLS" class="lemma"><strong>Lemma A.4  (Asymptotic Distribution of the OLS Estimator)  </strong></span>Under Assumptions <a href="FPCI.html#def:noselb">1.7</a>, <a href="FPSI.html#def:fullrank">2.3</a>, <a href="FPSI.html#def:iid">2.4</a> and <a href="FPSI.html#def:finitevar">2.5</a>, we have:</p>
<span class="math display">\[\begin{align*}
  \sqrt{N}(\hat{\Theta}_{OLS}-\Theta) &amp;  \stackrel{d}{\rightarrow}
  \mathcal{N}\left(\begin{array}{c} 0\\ 0\end{array},
  \sigma_{XX}^{-1}\mathbf{V_{xu}}\sigma_{XX}^{-1}\right), 
\end{align*}\]</span>
with
<span class="math display">\[\begin{align*}
\sigma_{XX}^{-1}&amp; = \left(\begin{array}{cc} \frac{\Pr(D_i=1)}{\Pr(D_i=1)(1-\Pr(D_i=1))} &amp; -\frac{\Pr(D_i=1)}{\Pr(D_i=1)(1-\Pr(D_i=1))}\\
                                          -\frac{\Pr(D_i=1)}{\Pr(D_i=1)(1-\Pr(D_i=1))} &amp; \frac{1}{\Pr(D_i=1)(1-\Pr(D_i=1))} 
                          \end{array}\right)\\
\mathbf{V_{xu}}&amp;= \esp{U_i^2\left(\begin{array}{cc}  1 &amp; D_i\\  D_i &amp; D_i\end{array}\right)}                        
\end{align*}\]</span>
</div>


<div class="proof">
 <span class="proof"><em>Proof. </em></span> 
<span class="math display">\[\begin{align*}
\sqrt{N}(\hat{\Theta}_{OLS}-\Theta) &amp; = \sqrt{N}((X&#39;X)^{-1}X&#39;Y-\Theta) \\
                                    &amp; = \sqrt{N}((X&#39;X)^{-1}X&#39;(X\Theta+U)-\Theta) \\
                                    &amp; = \sqrt{N}((X&#39;X)^{-1}X&#39;X\Theta+(X&#39;X)^{-1}X&#39;U)-\Theta) \\
                                    &amp; = \sqrt{N}(X&#39;X)^{-1}X&#39;U \\
                                    &amp; = N(X&#39;X)^{-1}\frac{\sqrt{N}}{N}X&#39;U
\end{align*}\]</span>
<p>Using Slutsky’s Theorem, we can study both terms separately. Slutsky’s Theorem states that if <span class="math inline">\(Y_N\stackrel{d}{\rightarrow}y\)</span> and <span class="math inline">\(\text{plim}(X_N)=x\)</span>, then:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(X_N+Y_N\stackrel{d}{\rightarrow}x+y\)</span></li>
<li><span class="math inline">\(X_NY_N\stackrel{d}{\rightarrow}xy\)</span></li>
<li><span class="math inline">\(\frac{Y_N}{X_N}\stackrel{d}{\rightarrow}\frac{x}{y}\)</span> if <span class="math inline">\(x\neq0\)</span></li>
</ol>
<p>Using this theorem, we have:</p>
<span class="math display">\[\begin{align*}
\sqrt{N}(\hat{\Theta}_{OLS}-\Theta) &amp; \stackrel{d}{\rightarrow} \sigma_{XX}^{-1}xu,
\end{align*}\]</span>
<p>Where <span class="math inline">\(\sigma_{XX}^{-1}\)</span> is a matrix of constants and <span class="math inline">\(xu\)</span> is a random variable.</p>
<p>Let’s begin with <span class="math inline">\(\frac{\sqrt{N}}{N}X&#39;U\stackrel{d}{\rightarrow}xu\)</span>:</p>
<span class="math display">\[\begin{align*}
\frac{\sqrt{N}}{N}X&#39;U &amp; = \sqrt{N}\left(\begin{array}{c}  \frac{1}{N}\sum^{i=1}_{N}U_i\\  \frac{1}{N}\sum^{i=1}_{N}D_iU_i\end{array}\right)
\end{align*}\]</span>
<p>In order to determine the asymptotic distribution of <span class="math inline">\(\frac{\sqrt{N}}{N}X&#39;U\)</span>, we are going to use the vector version of the CLT:</p>
<p>If <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Y_i\)</span> are two i.i.d. random variables with finite first and second moments, we have:</p>
<span class="math display">\[\begin{align*}
    \sqrt{N}
  \left(
      \begin{array}{c}  
       \frac{1}{N}\sum_{i=1}^NX_i-\esp{X_i}\\   
       \frac{1}{N}\sum_{i=1}^NY_i-\esp{Y_i}
       \end{array}
     \right) 
      &amp;
  \stackrel{d}{\rightarrow}
  \mathcal{N}
  \left(
    \begin{array}{c}    
    0\\
    0
    \end{array},
  \mathbf{V}
  \right),
\end{align*}\]</span>
<p>where <span class="math inline">\(\mathbf{V}\)</span> is the population covariance matrix of <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Y_i\)</span>.</p>
<p>We know that, under Assumption <a href="FPCI.html#def:noselb">1.7</a>, both random variables have mean zero:</p>
<span class="math display">\[\begin{align*}
\esp{U_i}&amp; = \esp{U_i|D_i=1}\Pr(D_i=1)+\esp{U_i|D_i=0}\Pr(D_i=0)=0 \\
\esp{U_iD_i}&amp; = \esp{U_i|D_i=1}\Pr(D_i=1)=0
\end{align*}\]</span>
<p>Their covariance matrix <span class="math inline">\(\mathbf{V_{xu}}\)</span> can be computed as follows:</p>
<span class="math display">\[\begin{align*}
\mathbf{V_{xu}} &amp; = \esp{\left(\begin{array}{c}  U_i\\  UiD_i\end{array}\right)\left(\begin{array}{cc}  U_i&amp;    UiD_i\end{array}\right)}
                  - \esp{\left(\begin{array}{c} U_i\\   UiD_i\end{array}\right)}\esp{\left(\begin{array}{cc}    U_i&amp;    UiD_i\end{array}\right)}\\
                &amp; = \esp{\left(\begin{array}{cc}    U_i^2 &amp; U_i^2D_i\\  Ui^2D_i &amp; U_i^2D_i^2\end{array}\right)} 
                  = \esp{U_i^2\left(\begin{array}{cc}   1 &amp; D_i\\   D_i &amp; D_i^2\end{array}\right)} 
                  = \esp{U_i^2\left(\begin{array}{cc}   1 &amp; D_i\\   D_i &amp; D_i\end{array}\right)} 
\end{align*}\]</span>
<p>Using the Vector CLT, we have that <span class="math inline">\(\frac{\sqrt{N}}{N}X&#39;U\stackrel{d}{\rightarrow}\mathcal{N}\left(\begin{array}{c} 0\\ 0\end{array},\mathbf{V_{xu}}\right)\)</span>.</p>
<p>Let’s show now that <span class="math inline">\(\plims N(X&#39;X)^{-1}=\sigma_{XX}^{-1}\)</span>:</p>
<span class="math display">\[\begin{align*}
N(X&#39;X)^{-1} &amp; = \frac{N}{N\sum_{i=1}^ND_i-\left(\sum_{i=1}^ND_i\right)^2}
                \left(\begin{array}{cc} \sum_{i=1}^ND_i &amp; -\sum_{i=1}^ND_i \\ -\sum_{i=1}^ND_i &amp; N \end{array}\right) \\
            &amp; = \frac{1}{N}\frac{1}{\frac{1}{N}\sum_{i=1}^ND_i-\left(\frac{1}{N}\sum_{i=1}^ND_i\right)^2}
                \left(\begin{array}{cc} \sum_{i=1}^ND_i &amp; -\sum_{i=1}^ND_i \\ -\sum_{i=1}^ND_i &amp; N \end{array}\right)\\
            &amp; = \frac{1}{\frac{1}{N}\sum_{i=1}^ND_i-\left(\frac{1}{N}\sum_{i=1}^ND_i\right)^2}
                \left(\begin{array}{cc} \frac{1}{N}\sum_{i=1}^ND_i &amp; -\frac{1}{N}\sum_{i=1}^ND_i \\ -\frac{1}{N}\sum_{i=1}^ND_i &amp; 1 \end{array}\right)\\
\plims N(X&#39;X)^{-1} &amp; = \frac{1}{\plims\frac{1}{N}\sum_{i=1}^ND_i-\left(\plims\frac{1}{N}\sum_{i=1}^ND_i\right)^2}
                \left(\begin{array}{cc} \plims\frac{1}{N}\sum_{i=1}^ND_i &amp; -\plims\frac{1}{N}\sum_{i=1}^ND_i \\ -\plims\frac{1}{N}\sum_{i=1}^ND_i &amp; 1 \end{array}\right)\\
                  &amp; = \frac{1}{\Pr(D_i=1)-\Pr(D_i=1)^2}
                \left(\begin{array}{cc} \Pr(D_i=1) &amp; -\Pr(D_i=1) \\ -\Pr(D_i=1) &amp; 1 \end{array}\right)\\
                 &amp; = \sigma_{XX}^{-1}
\end{align*}\]</span>
<p>The fourth equality uses Slutsky’s Theorem. The fifth equality uses the Law of Large Numbers (LLN): if <span class="math inline">\(Y_i\)</span> are i.i.d. variables with finite first and second moments, <span class="math inline">\(\plim{N}\frac{1}{N}\sum_{i=1}^NY_i = \esp{Y_i}\)</span>.</p>
<p>In order to complete the proof, we have to use the Delta Method Theorem. This theorem states that:</p>
<span class="math display">\[\begin{gather*}
  \sqrt{N}(\begin{array}{c} \bar{X}_N-\esp{X_i}\\   \bar{Y}_N-\esp{Y_i}\end{array})  \stackrel{d}{\rightarrow}\mathcal{N}(\begin{array}{c}  0\\ 0\end{array},\mathbf{V}) \\
\Rightarrow \sqrt{N}(g(\bar{X}_N,\bar{Y}_N)-g(\esp{X_i},\esp{Y_i})  \stackrel{d}{\rightarrow}\mathcal{N}(0,G&#39;\mathbf{V}G)
\end{gather*}\]</span>
<p>where <span class="math inline">\(G(u)=\partder{g(u)}{u}\)</span> and <span class="math inline">\(G=G(\esp{X_i},\esp{Y_i})\)</span>.</p>
In our case, <span class="math inline">\(g(xu)=\sigma_{XX}^{-1}xu\)</span>, so <span class="math inline">\(G(xu)=\sigma_{XX}^{-1}\)</span>. The results follows from that and from the symmetry of <span class="math inline">\(\sigma_{XX}^{-1}\)</span>.
</div>

<p>A last lemma uses the previous result to derive the asymptotic distribution of <span class="math inline">\(\hat{WW}\)</span>:</p>

<div class="lemma">
<p><span id="lem:asymWW" class="lemma"><strong>Lemma A.5  (Asymptotic Distribution of <span class="math inline">\(\hat{WW}\)</span>)  </strong></span>Under Assumptions <a href="FPCI.html#def:noselb">1.7</a>, <a href="FPSI.html#def:fullrank">2.3</a>, <a href="FPSI.html#def:iid">2.4</a> and <a href="FPSI.html#def:finitevar">2.5</a>, we have:</p>
<span class="math display">\[\begin{align*}
  \sqrt{N}(\hat{\Delta^Y_{WW}}-\Delta^Y_{TT}) &amp;  \stackrel{d}{\rightarrow}
  \mathcal{N}\left(0,\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}\right).
\end{align*}\]</span>
</div>


<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> In order to derive the asymptotic distribution of WW, I use first Lemma <a href="proofs.html#lem:WWOLS">A.3</a> which implies that the asymptotic distribution of WW is the same as that of <span class="math inline">\(\hat{\beta}_{OLS}\)</span>. Now, from Lemma <a href="proofs.html#lem:asympOLS">A.4</a>, we know that <span class="math inline">\(\sqrt{N}(\hat{\beta}_{OLS}-\beta)\stackrel{d}{\rightarrow}\mathcal{N}(0,\sigma^2_{\beta})\)</span>, where <span class="math inline">\(\sigma^2_{\beta}\)</span> is the lower diagonal term of <span class="math inline">\(\sigma_{XX}^{-1}\mathbf{V_{xu}}\sigma_{XX}^{-1}\)</span>. Using the convention <span class="math inline">\(p=\Pr(D_i=1)\)</span>, we have:</p>
<span class="math display">\[\begin{align*}
\sigma_{XX}^{-1}\mathbf{V_{xu}}\sigma_{XX}^{-1} 
                  &amp; = \left(\begin{array}{cc}  
                                          \frac{p}{p(1-p)} &amp; -\frac{p}{p(1-p)}\\
                                          -\frac{p}{p(1-p)} &amp; \frac{1}{p(1-p)} 
                          \end{array}\right)
                          \esp{U_i^2\left(\begin{array}{cc}  1 &amp; D_i\\  D_i &amp; D_i\end{array}\right)}        
                          \left(\begin{array}{cc}  
                                          \frac{p}{p(1-p)} &amp; -\frac{p}{p(1-p)}\\
                                          -\frac{p}{p(1-p)} &amp; \frac{1}{p(1-p)} 
                          \end{array}\right)\\
                  &amp; = \frac{1}{(p(1-p))^2}
                          \left(\begin{array}{cc}  
                                          p\esp{U_i^2}-p\esp{U_i^2D_i} &amp; p\esp{U_i^2D_i}-p\esp{U_i^2D_i}\\
                                          -p\esp{U_i^2}+\esp{U_i^2D_i} &amp;  -p\esp{U_i^2D_i}+\esp{U_i^2D_i}
                          \end{array}\right)
                         \left(\begin{array}{cc}  
                                          p &amp; -p\\
                                          -p &amp; 1 
                          \end{array}\right)\\
                 &amp; = \frac{1}{(p(1-p))^2}
                          \left(\begin{array}{cc}  
                                          p^2(\esp{U_i^2}-\esp{U_i^2D_i}) &amp; p^2(\esp{U_i^2D_i}-\esp{U_i^2})\\
                                          p^2(\esp{U_i^2D_i}-\esp{U_i^2}) &amp;  p^2\esp{U_i^2}+(1-2p)\esp{U_i^2D_i}
                          \end{array}\right)
 \end{align*}\]</span>
<p>The final result comes from the fact that:</p>
<span class="math display">\[\begin{align*}
\esp{U_i^2} &amp; = \esp{U_i^2|D_i=1}p + (1-p)\esp{U_i^2|D_i=0}\\
            &amp; = p\var{Y_i^1|D_i=1}+(1-p)\var{Y_i^0|D_i=0} \\
\esp{U_i^2D_i}  &amp; = \esp{U_i^2|D_i=1}p  \\
                &amp; = p\var{Y_i^1|D_i=1}.
 \end{align*}\]</span>
<p>As a consequence:</p>
<span class="math display">\[\begin{align*}
\sigma^2_{\beta} &amp;= \frac{1}{(p(1-p))^2}\left(\var{Y_i^1|D_i=1}p(p^2-2p+1) + p^2(1-p)\var{Y_i^0|D_i=0}\right) \\
                  &amp;= \frac{1}{(p(1-p))^2}\left(\var{Y_i^1|D_i=1}p(1-p)^2 + p^2(1-p)\var{Y_i^0|D_i=0}\right)\\
                  &amp; = \frac{\var{Y_i^1|D_i=1}}{p}+\frac{\var{Y_i^0|D_i=0}}{1-p}.
 \end{align*}\]</span>
</div>

<p>Using the previous lemma, we can now approximate the confidence level of <span class="math inline">\(\hat{WW}\)</span>:</p>
<span class="math display">\[\begin{align*}
\Pr&amp;(|\hat{\Delta^Y_{WW}}-\Delta^Y_{TT}|\leq\epsilon) = \Pr(-\epsilon\leq\hat{\Delta^Y_{WW}}-\Delta^Y_{TT}\leq\epsilon) \\
&amp; = \Pr\left(-\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\leq\frac{\hat{\Delta^Y_{WW}}-\Delta^Y_{TT}}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\leq\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)\\
&amp; \approx \Phi\left(\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)-
\Phi\left(-\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)\\
&amp; = \Phi\left(\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)- 1 + \Phi\left(\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)\\
&amp; = 2\Phi\left(\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)-1.
\end{align*}\]</span>
<p>As a consequence,</p>
<span class="math display">\[\begin{align*}
\delta &amp; \approx 2\Phi\left(\frac{\epsilon}{\frac{1}{\sqrt{N}}\sqrt{\frac{\var{Y_i^1|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_i^0|D_i=0}}{1-\Pr(D_i=1)}}}\right)-1.
\end{align*}\]</span>
<p>Hence the result.</p>
</div>
</div>
<div id="proofs-of-results-in-chapter-refrct" class="section level2">
<h2><span class="header-section-number">A.2</span> Proofs of results in Chapter <a href="RCT.html#RCT">3</a></h2>
<div id="proofWaldIV" class="section level3">
<h3><span class="header-section-number">A.2.1</span> Proof of Lemma <a href="RCT.html#lem:WaldIV">3.1</a></h3>
<p>In matrix notation, we have:</p>
<span class="math display">\[\begin{align*}
  \underbrace{\left(\begin{array}{c}  Y_1 \\    \vdots \\   Y_N \end{array}\right)}_{Y} &amp; =
  \underbrace{\left(\begin{array}{cc}   1 &amp; D_1\\   \vdots &amp; \vdots\\   1 &amp; D_N\end{array}\right)}_{X}
  \underbrace{\left(\begin{array}{c}    \alpha \\   \beta \end{array}\right)}_{\Theta}+
  \underbrace{\left(\begin{array}{c}    U_1 \\  \vdots \\   U_N \end{array}\right)}_{U}
\end{align*}\]</span>
<p>and</p>
<span class="math display">\[\begin{align*}
  \left(\begin{array}{c}  D_1 \\    \vdots \\   D_N \end{array}\right) &amp; =
  \underbrace{\left(\begin{array}{cc}   1 &amp; R_1\\   \vdots &amp; \vdots\\   1 &amp; R_N\end{array}\right)}_{R}
  \left(\begin{array}{c}    \gamma \\   \tau \end{array}\right)+
  \left(\begin{array}{c}    V_1 \\  \vdots \\   V_N \end{array}\right)
\end{align*}\]</span>
<p>The IV estimator is:</p>
<span class="math display">\[\begin{align*}
    \hat{\Theta}_{IV} &amp;  = (R&#39;X)^{-1}R&#39;Y
\end{align*}\]</span>
<p>Under Assumption <a href="FPSI.html#def:fullrank">2.3</a>, <span class="math inline">\(R&#39;X\)</span> is invertible and we have (ommitting the summation index for simplicity):</p>
<span class="math display">\[\begin{align*}
(R&#39;X)^{-1} &amp;  = \left(\begin{array}{cc} N &amp; \sum D_i \\ \sum R_i &amp; \sum D_iR_i \end{array}\right)^{-1} \\
                &amp; = \frac{1}{N\sum D_iR_i-\sum D_i\sum R_i}\left(\begin{array}{cc} \sum D_iR_i &amp; -\sum D_i \\ -\sum R_i &amp; N \end{array}\right)
\end{align*}\]</span>
<p>We have:</p>
<span class="math display">\[\begin{align*}
  \hat{\Theta}_{IV} &amp;  =  \left(
                              \begin{array}{c}
                                \frac{\sum Y_i\sum D_iR_i-\sum D_i\sum Y_iR_i}{N\sum D_iR_i -\sum D_iR_i}\\
                                \frac{N\sum Y_iR_i-\sum R_i\sum Y_i}{N\sum D_iR_i-\sum D_iR_i}
                              \end{array}
                          \right)
\end{align*}\]</span>
<p>As a consequence, <span class="math inline">\(\hat{\beta}_{IV}\)</span> is equal to the ratio of two OLS estimators (<span class="math inline">\(Y_i\)</span> on <span class="math inline">\(R_i\)</span> and a constant and <span class="math inline">\(D_i\)</span> on the same regressors) (see the proof of Lemma <a href="proofs.html#lem:WWOLS">A.3</a> in section <a href="proofs.html#proofCLT">A.1.2</a>, just after “Using <span class="math inline">\(D_i^2=D_i\)</span>”). We can use Lemma <a href="proofs.html#lem:WWOLS">A.3</a> stating that the OLS estimator is the WW estimator to prove the result.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Bounds.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/20_Appendix.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
